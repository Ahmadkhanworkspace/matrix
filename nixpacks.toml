[phases.setup]
nixPkgs = ["nodejs-18_x"]

[phases.install]
cmds = [
  "npm ci",
  "cd backend && npm ci --production && cd ..",
  "npm install -g prisma || true",
  "npx prisma generate --schema=./prisma/schema.prisma",
  "ls -la node_modules/@prisma/client || echo 'Prisma client check failed'",
  "cd backend && cp -r ../node_modules/@prisma backend/node_modules/@prisma 2>/dev/null || echo 'Copy skipped' || true"
]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "node backend/src/server.js"

